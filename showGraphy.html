<!-- writed by lichuan. 2020-6-23, for exercise-->
<!DOCTYPE html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>
<html>
    <body>
        <div style="width: 80%;margin: 0 auto;">
            <canvas id="startAndEndTimeInDay"></canvas>
            <canvas id="minMaxByMonth"></canvas>
            <canvas id="sumByWeek"></canvas>
            <canvas id="sumByMonth"></canvas>
        </div>
    </body>

    <script>
        $(document).ready(function () {
            showGraphy('sumByMonth',{
                labels: ['2019-06-30','2019-07-31','2019-08-31','2019-09-30','2019-10-31','2019-11-30','2019-12-31','2020-01-31','2020-02-29','2020-03-31','2020-04-30','2020-05-31'],
                data: [183.72,205.42,188.80,172.75,191.82,176.35,178.15,163.62,162.08,182.05,179.40,154.88],
                meanData: [183.72,194.57,192.64,188.99,184.46,180.31,182.11,172.71,167.95,169.25,174.51,172.11],
                dataGraphyType: 'bar',
                meanDataGraphyType: 'line',
                labelText: 'worktime sum by month',
                meanLabelText: 'monthly mean by quater',
                title: 'worktime sumed by month',
                showNumberOn: [0],
            })
            showGraphy('sumByWeek',{
                labels: ['2019-06-03','2019-06-10','2019-06-17','2019-06-24','2019-07-01','2019-07-08','2019-07-15','2019-07-22','2019-07-29','2019-08-05','2019-08-12','2019-08-19','2019-08-26','2019-09-02','2019-09-09','2019-09-16','2019-09-23','2019-09-30','2019-10-07','2019-10-14','2019-10-21','2019-10-28','2019-11-04','2019-11-11','2019-11-18','2019-11-25','2019-12-02','2019-12-09','2019-12-16','2019-12-23','2019-12-30','2020-01-06','2020-01-13','2020-01-20','2020-01-27','2020-02-03','2020-02-10','2020-02-17','2020-02-24','2020-03-02','2020-03-09','2020-03-16','2020-03-23','2020-03-30','2020-04-06','2020-04-13','2020-04-20','2020-04-27','2020-05-04','2020-05-11','2020-05-18','2020-05-25','2020-06-01'],
                data: [9.07,44.65,45.80,48.85,44.10,46.07,36.05,45.67,45.87,49.90,33.02,45.37,44.37,47.90,42.32,34.88,35.57,51.25,46.43,35.20,46.83,35.87,36.40,44.97,38.82,46.53,45.90,42.70,43.65,44.45,38.57,9.38,35.50,45.98,36.88,44.12,43.53,39.90,30.53,48.33,45.98,42.53,33.97,43.10,42.40,40.15,41.82,41.78,29.33,25.92,42.50,43.63,34.75],
                meanData: [9.07,26.86,33.17,37.09,45.85,46.20,43.77,42.97,43.41,44.37,43.61,43.54,43.16,42.66,44.99,42.37,40.17,41.00,42.03,42.11,44.93,41.08,38.58,41.02,39.01,41.68,44.05,43.49,44.70,44.17,42.34,34.01,31.97,32.36,31.94,40.62,42.63,41.11,39.52,40.57,41.19,41.85,42.70,41.40,40.50,39.90,41.87,41.54,38.27,34.71,34.88,35.35,36.70],
                dataGraphyType: 'bar',
                meanDataGraphyType: 'line',
                labelText: 'worktime sum by week',
                meanLabelText: 'weekly mean by month',
                title: 'worktime sumed by week',
                showNumberOn: [0],
            })
            showGraphy('minMaxByMonth',{
                labels: ['2019-06-30','2019-07-31','2019-08-31','2019-09-30','2019-10-31','2019-11-30','2019-12-31','2020-01-31','2020-02-29','2020-03-31','2020-04-30','2020-05-31'],
                data: [7.92,7.83,7.88,7.83,8.27,8.30,7.78,8.13,3.82,6.30,8,8.05],
                meanData: [10.90,12.53,12.13,12.37,11.72,11.75,11.85,10.43,12.90,9.85,13.22,9.57],
                dataGraphyType: 'bar',
                meanDataGraphyType: 'bar',
                labelText: 'min by month',
                meanLabelText: 'max by month',
                title: 'min and max by month',
                showNumberOn: [0,1],
            })
            showGraphy('startAndEndTimeInDay',{
                labels: ['2019-06-03','2019-06-04','2019-06-05','2019-06-06','2019-06-07','2019-06-10','2019-06-11','2019-06-12','2019-06-13','2019-06-14','2019-06-17','2019-06-18','2019-06-19','2019-06-20','2019-06-21','2019-06-24','2019-06-25','2019-06-26','2019-06-27','2019-06-28','2019-07-01','2019-07-02','2019-07-03','2019-07-04','2019-07-05','2019-07-08','2019-07-09','2019-07-10','2019-07-11','2019-07-12','2019-07-16','2019-07-17','2019-07-18','2019-07-19','2019-07-22','2019-07-23','2019-07-24','2019-07-25','2019-07-26','2019-07-29','2019-07-30','2019-07-31','2019-08-01','2019-08-02','2019-08-05','2019-08-06','2019-08-07','2019-08-08','2019-08-09','2019-08-13','2019-08-14','2019-08-15','2019-08-16','2019-08-19','2019-08-20','2019-08-21','2019-08-22','2019-08-23','2019-08-26','2019-08-27','2019-08-28','2019-08-29','2019-08-30','2019-09-02','2019-09-03','2019-09-04','2019-09-05','2019-09-06','2019-09-09','2019-09-10','2019-09-11','2019-09-12','2019-09-13','2019-09-17','2019-09-18','2019-09-19','2019-09-20','2019-09-24','2019-09-25','2019-09-26','2019-09-27','2019-09-30','2019-10-01','2019-10-02','2019-10-03','2019-10-04','2019-10-07','2019-10-08','2019-10-09','2019-10-10','2019-10-11','2019-10-15','2019-10-16','2019-10-17','2019-10-18','2019-10-21','2019-10-23','2019-10-24','2019-10-25','2019-10-28','2019-10-29','2019-10-30','2019-10-31','2019-11-01','2019-11-05','2019-11-06','2019-11-07','2019-11-08','2019-11-11','2019-11-12','2019-11-13','2019-11-14','2019-11-18','2019-11-19','2019-11-20','2019-11-21','2019-11-22','2019-11-25','2019-11-26','2019-11-27','2019-11-28','2019-11-29','2019-12-02','2019-12-03','2019-12-04','2019-12-05','2019-12-06','2019-12-09','2019-12-10','2019-12-11','2019-12-12','2019-12-13','2019-12-16','2019-12-17','2019-12-18','2019-12-19','2019-12-20','2019-12-23','2019-12-24','2019-12-25','2019-12-26','2019-12-27','2020-01-06','2020-01-07','2020-01-08','2020-01-09','2020-01-10','2020-01-14','2020-01-15','2020-01-16','2020-01-17','2020-01-20','2020-01-21','2020-01-22','2020-01-24','2020-01-27','2020-01-28','2020-01-29','2020-01-30','2020-01-31','2020-02-03','2020-02-04','2020-02-05','2020-02-06','2020-02-07','2020-02-10','2020-02-12','2020-02-13','2020-02-14','2020-02-17','2020-02-18','2020-02-19','2020-02-20','2020-02-21','2020-02-25','2020-02-26','2020-02-27','2020-02-28','2020-03-02','2020-03-03','2020-03-04','2020-03-05','2020-03-06','2020-03-09','2020-03-10','2020-03-11','2020-03-12','2020-03-13','2020-03-16','2020-03-17','2020-03-18','2020-03-19','2020-03-23','2020-03-24','2020-03-25','2020-03-26','2020-03-27','2020-03-30','2020-03-31','2020-04-01','2020-04-02','2020-04-03','2020-04-06','2020-04-07','2020-04-08','2020-04-09','2020-04-10','2020-04-13','2020-04-14','2020-04-15','2020-04-16','2020-04-17','2020-04-20','2020-04-21','2020-04-22','2020-04-23','2020-04-24','2020-04-27','2020-04-28','2020-04-30','2020-05-01','2020-05-07','2020-05-08','2020-05-11','2020-05-12','2020-05-13','2020-05-14','2020-05-15','2020-05-18','2020-05-19','2020-05-20','2020-05-21','2020-05-22','2020-05-25','2020-05-26','2020-05-27','2020-05-28','2020-05-29'],
                title: 'start and end time of everyday',
                showNumberOn: [],
                dataGraphyType: 'line',
                dataExp: [{
                    label: 'starttime',
                    data: [9.72,9.72,9.72,9.67,9.7,9.75,9.67,9.75,9.75,9.78,9.83,9.67,9.72,9.7,9.7,9.83,9.83,9.67,9.83,9.83,9.75,9.72,9.75,9.75,9.73,9.67,9.83,9.78,9.75,9.78,9.78,9.82,9.77,9.72,9.88,9.92,9.75,9.92,9.62,9.75,9.77,9.72,10.05,9.72,10.0,9.98,9.83,9.78,10.03,9.92,9.72,9.8,9.82,9.68,9.62,9.77,9.65,9.72,9.72,9.55,9.8,9.73,9.9,9.57,9.7,9.83,9.8,9.75,10.55,9.85,9.92,9.72,9.93,9.87,9.78,9.92,9.9,9.63,9.78,9.75,9.78,9.93,9.73,9.8,9.85,9.9,9.72,9.53,9.58,9.47,9.65,9.73,9.65,10.05,9.7,9.63,9.55,9.63,9.8,9.75,9.78,9.78,9.65,9.62,9.67,9.52,9.8,9.5,9.62,9.55,9.67,9.5,9.9,9.72,9.65,9.95,9.53,9.85,9.63,9.68,9.58,9.68,9.73,9.67,9.65,9.8,9.67,9.75,9.62,9.93,9.83,9.72,9.75,9.82,9.73,9.73,9.77,9.8,9.78,10.03,9.72,9.73,9.68,9.82,9.77,9.8,9.7,9.73,9.7,9.55,9.72,9.72,9.75,9.75,9.65,9.9,9.8,9.78,9.73,9.92,9.87,9.85,9.58,9.62,9.68,9.95,9.83,9.57,9.6,9.73,9.77,14.75,9.77,9.55,9.7,9.68,9.65,9.82,9.63,9.62,9.65,9.68,9.73,9.72,9.73,9.62,9.85,9.72,9.87,10.03,9.5,9.57,9.73,9.68,9.6,12.13,9.5,9.73,9.5,9.58,9.5,9.5,9.5,9.6,9.5,9.5,9.5,9.5,9.5,9.5,9.5,9.5,9.42,9.47,9.47,9.43,9.4,8.67,9.77,9.47,9.42,9.28,9.43,9.28,9.28,9.52,9.28,9.27,9.45,9.4,9.42,9.38,9.48,9.45,9.43,9.42,9.52,9.45],
                    type: 'line',
                },{
                    label: 'startTimeRollingMonth',
                    data: [9.72,9.72,9.72,9.7,9.7,9.71,9.7,9.71,9.71,9.72,9.73,9.73,9.73,9.72,9.72,9.73,9.74,9.73,9.74,9.74,9.74,9.74,9.74,9.74,9.74,9.74,9.74,9.74,9.74,9.75,9.75,9.75,9.75,9.75,9.76,9.77,9.77,9.77,9.77,9.77,9.77,9.77,9.78,9.78,9.79,9.79,9.79,9.8,9.81,9.81,9.81,9.81,9.81,9.81,9.81,9.81,9.8,9.8,9.8,9.79,9.79,9.79,9.79,9.79,9.78,9.78,9.78,9.78,9.81,9.81,9.82,9.82,9.81,9.82,9.81,9.81,9.81,9.8,9.8,9.79,9.79,9.8,9.79,9.8,9.81,9.81,9.81,9.81,9.8,9.8,9.79,9.79,9.79,9.8,9.8,9.8,9.79,9.78,9.76,9.76,9.75,9.75,9.74,9.74,9.73,9.72,9.71,9.71,9.7,9.7,9.69,9.68,9.69,9.68,9.68,9.68,9.67,9.68,9.68,9.69,9.69,9.69,9.69,9.68,9.68,9.68,9.68,9.69,9.68,9.69,9.69,9.69,9.69,9.7,9.7,9.71,9.71,9.72,9.72,9.74,9.74,9.75,9.74,9.74,9.75,9.74,9.75,9.74,9.75,9.74,9.75,9.75,9.75,9.75,9.75,9.75,9.76,9.76,9.76,9.76,9.76,9.77,9.76,9.76,9.75,9.76,9.76,9.76,9.75,9.74,9.74,9.91,9.91,9.9,9.9,9.9,9.9,9.9,9.9,9.9,9.9,9.89,9.89,9.89,9.9,9.89,9.89,9.89,9.89,9.89,9.88,9.87,9.88,9.88,9.88,9.95,9.94,9.94,9.94,9.94,9.93,9.75,9.74,9.74,9.74,9.73,9.73,9.72,9.71,9.71,9.7,9.7,9.69,9.68,9.67,9.66,9.65,9.61,9.61,9.59,9.59,9.58,9.57,9.56,9.54,9.46,9.45,9.43,9.43,9.43,9.42,9.42,9.42,9.41,9.41,9.41,9.41,9.41],
                    type: 'line',
                },{
                    label: 'endTime',
                    data: [19.78,19.12,19.83,19.82,19.82,19.62,20.48,20.5,19.5,19.22,19.88,19.82,19.67,19.67,21.6,21.72,21.0,19.77,18.75,19.0,19.5,19.5,19.75,20.23,20.25,19.95,18.67,19.62,20.25,20.67,19.5,19.95,20.0,20.43,19.75,19.73,19.92,19.58,19.65,20.93,21.25,23.25,19.93,19.9,19.82,19.88,18.72,18.88,19.17,19.7,19.85,19.87,20.33,19.55,19.28,19.25,20.13,19.88,19.28,19.1,19.5,20.52,23.03,19.3,19.45,19.58,19.03,19.5,19.38,19.33,19.28,19.3,20.38,19.53,19.98,19.9,19.62,19.62,20.27,21.13,20.82,23.3,19.9,20.67,20.55,19.8,19.52,19.72,19.22,19.58,18.92,19.53,22.37,19.57,19.0,20.13,19.78,19.73,19.58,19.5,20.53,19.73,19.43,19.53,19.82,19.73,19.43,19.5,19.58,20.37,21.35,19.67,20.05,19.37,18.95,20.18,22.28,19.45,20.63,19.53,19.42,20.12,19.52,19.35,19.2,19.43,19.37,18.88,19.78,19.92,19.75,18.5,19.55,19.73,19.15,19.93,20.22,19.27,19.3,22.88,19.62,20.03,20.07,18.95,20.12,19.0,20.52,21.17,19.73,19.07,20.22,19.22,19.65,20.05,20.57,19.67,20.37,19.77,19.17,19.8,19.12,19.27,19.63,20.03,19.22,19.07,23.07,19.77,20.1,19.7,19.5,19.57,20.23,19.07,19.98,19.0,23.55,20.18,19.1,19.22,20.08,20.25,19.27,20.57,19.3,19.57,19.07,19.38,19.0,19.25,19.0,19.33,19.22,20.18,19.22,19.43,19.92,20.0,18.5,20.48,18.5,18.5,19.0,18.75,18.5,18.5,18.5,18.5,18.5,18.5,18.5,20.22,18.52,18.5,19.22,18.5,18.5,18.5,23.98,18.5,18.5,18.5,19.35,19.07,19.55,18.88,18.75,18.62,18.5,19.42,18.9,18.5,19.2,19.75,18.55,18.5,19.5,20.02],
                    type: 'line',
                },{
                    label: 'endTimeRollingMonth',
                    data: [19.78,19.45,19.58,19.64,19.67,19.66,19.78,19.87,19.83,19.77,19.78,19.78,19.77,19.77,19.89,20.0,20.06,20.04,19.98,19.93,19.91,19.89,19.88,19.9,19.91,19.91,19.87,19.86,19.87,19.9,19.89,19.92,19.92,19.94,19.94,19.94,19.92,19.89,19.9,19.96,20.0,20.12,20.13,20.13,20.07,20.01,19.94,19.91,19.92,19.94,19.96,19.97,19.99,19.96,19.93,19.91,19.96,19.97,19.93,19.88,19.88,19.9,20.0,19.96,19.95,19.95,19.92,19.92,19.91,19.86,19.79,19.66,19.67,19.66,19.67,19.67,19.7,19.72,19.76,19.81,19.84,19.95,19.94,19.98,20.02,20.04,20.02,20.01,20.01,20.02,20.0,19.97,19.95,19.96,19.94,19.96,19.99,19.99,20.0,20.01,20.05,20.06,20.03,20.03,20.03,20.02,20.01,20.01,19.99,19.96,19.98,19.86,19.86,19.82,19.77,19.78,19.87,19.86,19.91,19.91,19.92,19.94,19.85,19.84,19.85,19.83,19.81,19.78,19.79,19.8,19.78,19.74,19.74,19.75,19.72,19.73,19.76,19.75,19.74,19.82,19.77,19.78,19.78,19.77,19.8,19.76,19.71,19.76,19.73,19.72,19.74,19.71,19.72,19.74,19.79,19.8,19.83,19.86,19.84,19.83,19.81,19.84,19.84,19.85,19.85,19.82,19.92,19.94,19.96,19.86,19.85,19.84,19.84,19.85,19.84,19.84,19.94,19.91,19.89,19.89,19.89,19.92,19.91,19.93,19.89,19.88,19.84,19.83,19.82,19.8,19.8,19.8,19.79,19.79,19.79,19.81,19.7,19.71,19.65,19.68,19.65,19.61,19.57,19.56,19.51,19.49,19.33,19.27,19.25,19.23,19.17,19.17,19.15,19.08,19.07,19.04,19.02,18.99,19.16,19.13,19.12,19.09,19.09,19.05,19.07,19.05,19.01,18.96,18.96,18.93,18.94,18.94,18.95,18.98,18.98,18.98,19.02,19.07],
                    type: 'line',
                }],
                elements: {
                    point: {
                        radius: 0,
                    }
                },
                xtickCallBack: function (item, index, values) { // only show month date
                    if (index < values.length - 1) {
                        let tempDate = new Date(Date.parse(item));
                        let nextDate = new Date(Date.parse(values[index + 1]));

                        if (tempDate.getMonth() < nextDate.getMonth() || tempDate.getFullYear() < nextDate.getFullYear()) {
                            return item;
                        }
                    } else {
                        return item;
                    }
                },
                fixedXtickSkip: true,
                maxRotation: 30,
            })

            
            function showGraphy(id, params) {
                let ctx = document.getElementById(id).getContext('2d');
                let onlyDataGraphyType = params.onlyDataGraphyType ? params.onlyDataGraphyType : 'bar';
                let elements = params.elements ? params.elements : {};
                let xtickCallBack = null;
                let datasets = [];

                if (params.dataExp) {
                    params.dataExp.forEach(function (element) {
                        let color = 'rgb(' + getRandomInt(255) + ',' + getRandomInt(255) + ',' + getRandomInt(255) + ')';
                        datasets.push({
                            label: element.label,
                            data: element.data,
                            type: element.type,
                            borderColor: color,
                            fill: false,
                        })
                    });

                    function getRandomInt(max) {
                        return Math.floor(Math.random() * Math.floor(max));
                    }
                } else {
                    datasets = [{
                            label: params.labelText,
                            backgroundColor: 'rgb(255, 99, 132, 0.4)',
                            borderColor: 'rgb(255, 99, 132, 0.4)',
                            data: params.data,
                            type: onlyDataGraphyType,
                            fill: false,
                        },{
                            label: params.meanLabelText,
                            backgroundColor: 'rgb(0, 255, 0)',
                            borderColor: 'rgb(0, 255, 0)',
                            data: params.meanData,
                            type: params.meanDataGraphyType,
                            fill: false,
                        }];
                }

                if (params.xtickCallBack) {
                    xtickCallBack = params.xtickCallBack;
                }                

                let chart = new Chart(ctx, {
                    // The type of chart we want to create
                    type: params.dataGraphyType,

                    // The data for our dataset
                    data: {
                        labels: params.labels,
                        datasets: datasets
                    },

                    // Configuration options go here
                    options: {
                        title: {
                            display: true,
                            text: params.title,
                        },
                        tooltips: {
                            callbacks: {
                                title: function(item, data) {
                                    let toolTipTxt = '';
                                    
                                    for (let i = 0; i < item.length; i++) {
                                        toolTipTxt += data.labels[item[i].index];
                                        
                                        if (i < item.length - 1) {
                                            toolTipTxt += ';';
                                        }
                                    }

                                    return toolTipTxt;
                                },
                            },
                        },
                        scales: {
                            xAxes: [{
                                ticks: {
                                    maxRotation: params.maxRotation ? params.maxRotation : 90,
                                    minRotation: params.minRotation ? params.minRotation : 30,
                                    userCallback: xtickCallBack,
                                    autoSkip: params.fixedXtickSkip ? false : true,
                                }
                            }],
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        },
                        elements: elements,
                        animation: { // add number to bar
                            duration: 500,
                            onComplete: function () {
                                let ctx = this.chart.ctx;
                                ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontFamily, 'normal', Chart.defaults.global.defaultFontFamily);
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'bottom';

                                // get number and add it to bar
                                for (let s = 0; s < params.showNumberOn.length; s++){
                                    let dataset = this.data.datasets[params.showNumberOn[s]];
                                    for (let i = 0; i < dataset.data.length; i++) {
                                        let model = dataset._meta[Object.keys(dataset._meta)[0]].data[i]._model,
                                            scale_max = dataset._meta[Object.keys(dataset._meta)[0]].data[i]._yScale.maxHeight;
                                        ctx.fillStyle = '#444';
                                        let y_pos = model.y - 5;
                                        // Make sure data value does not get overflown and hidden
                                        // when the bar's value is too close to max value of scale
                                        // Note: The y value is reverse, it counts from top down
                                        if ((scale_max - model.y) / scale_max >= 0.93)
                                            y_pos = model.y + 20; 
                                        ctx.fillText(dataset.data[i], model.x, y_pos);
                                    }
                                }
                            }
                        }
                    }
                });
            }
        })
    </script>
</html>